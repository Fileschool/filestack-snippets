<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Avatar Creator Demo</title>
  <script src="https://static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .avatar-preview {
      margin-top: 20px;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid #333;
      display: none;
    }

    .avatar-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background-color: #eee;
      display: block;
    }
  </style>
</head>
<body>

  <h2>Create Your Avatar</h2>
  <button id="uploadAvatar">Upload & Crop Image</button>

  <div class="avatar-preview" id="avatarContainer">
    <img id="avatarImage" src="" alt="Your Avatar" />
  </div>

  <script>
    // ✅ Replace this with your actual Filestack API key
    const client = filestack.init('YOUR_API_KEY');

    document.getElementById('uploadAvatar').addEventListener('click', () => {
      client.picker({
        accept: ['image/*'],
        maxFiles: 1,
        transformations: {
          crop: {
            aspectRatio: 1 // Square crop for perfect avatar
          },
          rotate: true
        },
        onUploadDone: (res) => {
          const handle = res.filesUploaded[0].handle;

          // ✅ Use raw handle URL (no filters)
          const url = `https://cdn.filestackcontent.com/${handle}`;
          console.log("Avatar URL:", url);

          const avatarImg = document.getElementById('avatarImage');
          avatarImg.onload = () => {
            document.getElementById('avatarContainer').style.display = 'block';
          };

          avatarImg.onerror = () => {
            alert("Failed to load the avatar image.");
          };

          avatarImg.src = url;
        }
      }).open();
    });
  </script>

</body>
</html>
